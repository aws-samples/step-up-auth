// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: MIT-0

import { describe, expect, it, jest } from '@jest/globals';
import { CognitoToken } from '../lib/CognitoToken';

describe('CognitoToken test suite', () => {

  it('returns same token', () => {
    const tokenToTest = 'eyJraWQiOiJhMEJRTmJaSTRNaUNRUWxRSDg3Zlg1Q1ArOXdwN0ZVZEN3bmlzdGN6XC91Yz0iLCJhbGciOiJSUzI1NiJ9.eyJhdF9oYXNoIjoiSkxrN3FtZUE3UHFJMjNJTGdzb3hwZyIsInN1YiI6ImYyZWNhZTc0LTczNGEtNDA2My1hNjAzLWM1MWRjNGEyMzUwZCIsImN1c3RvbTppc19kcyI6IjAiLCJjb2duaXRvOmdyb3VwcyI6WyJ1cy1lYXN0LTFfZkxPdW0xbWYwX0FERlMiXSwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjdXN0b206aXNfdXNlciI6IjAiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9mTE91bTFtZjAiLCJwaG9uZV9udW1iZXJfdmVyaWZpZWQiOmZhbHNlLCJjb2duaXRvOnVzZXJuYW1lIjoiQURGU19tb2doYWxzXFxhbGljZSIsIm5vbmNlIjoiQXhpM3pSYmV1clFRcXpTREM4bkUySGxaQ1RubTF1S1cxRVNZcHYyMHFKajlmQjRMMnB1akdyWWFjV3BLdVFZcmlBV2oxUXRrNy1JR0JSb2k2eWRQb0lIQS16anBiVjNIZ0laeTdVVWN3Q2toWFU0aGNFbVoyNjJlbVhDYXY5TE5fOTlZSkVOaXQtcmg0MHhBR2FMdkIzOUp4cVF3ZlRpS01zNkV5cTNWWDhJIiwiY3VzdG9tOmlzX2FkbWluIjoiMSIsImN1c3RvbTppc19ybyI6IjAiLCJhdWQiOiI3cTQ5bDFlZ2Y4dW84OHMwOHNydGhjbW0zIiwiaWRlbnRpdGllcyI6W3sidXNlcklkIjoibW9naGFsc1xcYWxpY2UiLCJwcm92aWRlck5hbWUiOiJBREZTIiwicHJvdmlkZXJUeXBlIjoiU0FNTCIsImlzc3VlciI6Imh0dHA6XC9cL3N0cy5tb2doYWxzLmNjXC9hZGZzXC9zZXJ2aWNlc1wvdHJ1c3QiLCJwcmltYXJ5IjoidHJ1ZSIsImRhdGVDcmVhdGVkIjoiMTYxMzUwODY4ODMzMyJ9XSwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE2MTQ5MjcxNjIsInBob25lX251bWJlciI6Iis0NDAyMDc5NDYwMTIzIiwiZXhwIjoxNjE0OTMwNzYyLCJpYXQiOjE2MTQ5MjcxNjIsImVtYWlsIjoiYWxpY2VAbW9naGFscy5jYyJ9.bciNRpbYuIffqGGmy86RLXqtBdcEfSFFI1ggPNQY3c7ZSIk7knPusMyDZrcB8VeZEbJ5NqHIC_0YjBWyBImIbY5OCihpvhv0wSA1Xx4iCBdkctJqwuu27oV7Jrzzzc6FleEAEIXhl6Mfuc4wiR-3KVwgyzHvbmk0P6SroDtcR5ONwS6t_LCUQENR1Iftka4d-gI7r_NhELtHddcpFflJ2Ia4kSgSD4-28mW-Di6CqX_n8K2fcGEHVgxHecDhotCWW1kcqXMExpIMttUZ_6WImS0_vtO_WjV9b1B7DbXr7uJsrC2JKLhoHbcPEr_yIe6Z0aDOkccFaf0l-82NPJ1QeA';
    const token = new CognitoToken(tokenToTest);

    expect(token.getToken()).toEqual(tokenToTest);
  });

  it('returns id token', () => {
    const tokenToTest = 'eyJraWQiOiJhMEJRTmJaSTRNaUNRUWxRSDg3Zlg1Q1ArOXdwN0ZVZEN3bmlzdGN6XC91Yz0iLCJhbGciOiJSUzI1NiJ9.eyJhdF9oYXNoIjoiSkxrN3FtZUE3UHFJMjNJTGdzb3hwZyIsInN1YiI6ImYyZWNhZTc0LTczNGEtNDA2My1hNjAzLWM1MWRjNGEyMzUwZCIsImN1c3RvbTppc19kcyI6IjAiLCJjb2duaXRvOmdyb3VwcyI6WyJ1cy1lYXN0LTFfZkxPdW0xbWYwX0FERlMiXSwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJjdXN0b206aXNfdXNlciI6IjAiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9mTE91bTFtZjAiLCJwaG9uZV9udW1iZXJfdmVyaWZpZWQiOmZhbHNlLCJjb2duaXRvOnVzZXJuYW1lIjoiQURGU19tb2doYWxzXFxhbGljZSIsIm5vbmNlIjoiQXhpM3pSYmV1clFRcXpTREM4bkUySGxaQ1RubTF1S1cxRVNZcHYyMHFKajlmQjRMMnB1akdyWWFjV3BLdVFZcmlBV2oxUXRrNy1JR0JSb2k2eWRQb0lIQS16anBiVjNIZ0laeTdVVWN3Q2toWFU0aGNFbVoyNjJlbVhDYXY5TE5fOTlZSkVOaXQtcmg0MHhBR2FMdkIzOUp4cVF3ZlRpS01zNkV5cTNWWDhJIiwiY3VzdG9tOmlzX2FkbWluIjoiMSIsImN1c3RvbTppc19ybyI6IjAiLCJhdWQiOiI3cTQ5bDFlZ2Y4dW84OHMwOHNydGhjbW0zIiwiaWRlbnRpdGllcyI6W3sidXNlcklkIjoibW9naGFsc1xcYWxpY2UiLCJwcm92aWRlck5hbWUiOiJBREZTIiwicHJvdmlkZXJUeXBlIjoiU0FNTCIsImlzc3VlciI6Imh0dHA6XC9cL3N0cy5tb2doYWxzLmNjXC9hZGZzXC9zZXJ2aWNlc1wvdHJ1c3QiLCJwcmltYXJ5IjoidHJ1ZSIsImRhdGVDcmVhdGVkIjoiMTYxMzUwODY4ODMzMyJ9XSwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE2MTQ5MjcxNjIsInBob25lX251bWJlciI6Iis0NDAyMDc5NDYwMTIzIiwiZXhwIjoxNjE0OTMwNzYyLCJpYXQiOjE2MTQ5MjcxNjIsImVtYWlsIjoiYWxpY2VAbW9naGFscy5jYyJ9.bciNRpbYuIffqGGmy86RLXqtBdcEfSFFI1ggPNQY3c7ZSIk7knPusMyDZrcB8VeZEbJ5NqHIC_0YjBWyBImIbY5OCihpvhv0wSA1Xx4iCBdkctJqwuu27oV7Jrzzzc6FleEAEIXhl6Mfuc4wiR-3KVwgyzHvbmk0P6SroDtcR5ONwS6t_LCUQENR1Iftka4d-gI7r_NhELtHddcpFflJ2Ia4kSgSD4-28mW-Di6CqX_n8K2fcGEHVgxHecDhotCWW1kcqXMExpIMttUZ_6WImS0_vtO_WjV9b1B7DbXr7uJsrC2JKLhoHbcPEr_yIe6Z0aDOkccFaf0l-82NPJ1QeA';
    const idToken = new CognitoToken(tokenToTest);

    expect(idToken.isIdToken()).toBeTruthy();
    expect(idToken.isAccessToken()).toBeFalsy();
    // eslint-disable-next-line jest/prefer-to-be
    expect(idToken.getUsernameClaim()).toEqual('ADFS_moghals\\alice');
    // eslint-disable-next-line jest/prefer-to-be
    expect(idToken.getStepUpClaim()).toEqual('');
    // eslint-disable-next-line jest/prefer-to-be
    expect(idToken.getRequestIdClaim()).toEqual('');
  });

  it('returns bearer access token', () => {
    const tokenToTest = 'Bearer eyJraWQiOiJIKzJRWElCT09FTFB1dmk2WUU2UzBBZDM2czJuN2RYM09zS3E2dEVjRXFBPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJmMmVjYWU3NC03MzRhLTQwNjMtYTYwMy1jNTFkYzRhMjM1MGQiLCJjb2duaXRvOmdyb3VwcyI6WyJ1cy1lYXN0LTFfZkxPdW0xbWYwX0FERlMiXSwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCIsImF1dGhfdGltZSI6MTYxNDkyNzE2MiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfZkxPdW0xbWYwIiwiZXhwIjoxNjE0OTMwNzYyLCJpYXQiOjE2MTQ5MjcxNjIsInZlcnNpb24iOjIsImp0aSI6IjU5MzUyNzE3LTgwNzctNGE3Ni1iMmMxLWUwNTg3MTZmZGRhYiIsImNsaWVudF9pZCI6IjdxNDlsMWVnZjh1bzg4czA4c3J0aGNtbTMiLCJ1c2VybmFtZSI6IkFERlNfbW9naGFsc1xcYWxpY2UifQ.erWxgXTfVWk61fL0-BHNXiFodCWMwGjtwCxDwmTRibuY18nzWsSPy5YzPfhMe9FJ4wZmGPyFHXGw8N0KuEwRQ_u9QQjU1wLTMxrtBFgJflUKATo4qN0sPV3QRXllQpTtjrIQ7fIy4h5k85XSXwaCY_Y4FyH9xProMgteTfmEw_AGt-vcb_7QxUbWOrUekDmOdSc1l__sS-96EQYKMY2JULYjg_6lzWpLaMHxMBxLA3ePCqK90hPRxXW_K7Pksj8DWfGMARkxqr6rid9jFjNpcyUrKOL_YD7CylWqO344_Ea8sZT8pcskt1CJwBZDQI_tz23xQjQEZ5RZ7UxHo34DCQ';
    const accessToken = new CognitoToken(tokenToTest);

    expect(accessToken.isAccessToken()).toBeTruthy();
    expect(accessToken.isIdToken()).toBeFalsy();
    // eslint-disable-next-line jest/prefer-to-be
    expect(accessToken.getUsernameClaim()).toEqual('ADFS_moghals\\alice');
  });

  it('throws error when token is invalid', () => {
    const tokenToTest = 'eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.oCd3oYpB3inWpfCtFK46pR8S5tFfK2irLmheLnmF7XFb_nR571_ARpTCYDnHp9GN5jDe6Hkc6Ya2Lrejc-k7y3l1zh-vSi7hpfhT_f-5AGaDnskSbJWjPx-TWH22gkVGno3YGla1A1_tpzRgtBd0TxKF2oYH7y0v1FYzj474HXZ51tSsnSYNQ4QdvvDXdYW_M3ZgRdMcLROg5rJByV_JcZ9-fT6Z5Gougxx6SynUQKVe6vvP2ig-_tWTTTF1mdtKUf60lDriXMCePUBXL3LzcwWWofFTdd7o6saDpZPSiiYqI77yuOZAAaTcA8iHo946qQLTqnmumwMHENyI9U_VsA.WSy4IY1p2KkeczbH.GNGuoy5303ywOqdI5NpcxQhdVWA_d_2IEeKu1v8M6trkvvA21nPMTAJi_YvqP3Lqv7Brzaq6jJriQuLFzP1gCR-ZUIU5PKa1QEEc9fd9kI-hJkHK-t_ZcdETvxqJgbOBAicqm6wWKFjKq6CsySdVtg6ssgkZA0hC8IS4lqzYWDO2mZgbC8KlRObrgOL7pgB7kVc3Wq8iCIiY5HLMt7i06YHWLmwQViIM-nBAcYCV5Av27kmwZdfNgEcuYB66pZZNnuay1DDiGww4KAc1MB2KO5JCJw0s_K4zYCNUJUbHY8YCbQoRUcKr4Hrkx2G3rQ2big7hmwHQTMb1eWA75gJ3mWR1xRAkAnRpwVlwN8SQyVjd58FBsPVB89RgN9-oe0VRewEPEKUxVrFcp4KuG35R8MqcB8PzPU08gfUNEFwXpXBSvuga1b69sKy6r6Lx8buglvZDIBD5jDbGekUTeAFW8L4z8b7VhGwnP4boAka75j-s7JC7SPTXLII03Tbky86llKIjkPjGcvlDS34m6PTFzbs3H-9oEtE58MW22b4MSChN7IoDGyv6uWtuiGcOoi1iGOnHV_uNQQ09Q4d0xXWmIuoYszOcbXcl9OM96F6HPWft9FqavdtKIo9u6XZeP9Qm_QdJug9NEmLpnsOZetyckem0_KZdxjigvkcy0Yv_3ZJR-VhugruGoaXmmBicdE2vQBm00Btlh8EZKuus3vO2IXgNSCFVymvoX0uEWQhirdeBbZUu2YCukbKkf0DRmzENcUXDvNUYpiLY7QUwdWYVJu5waK28FJQG6c4mW0ov2U1ab9SC1LdIYz5GMpaDcwMAqvjsDp05tTBVs96K7yUTkPg7RRTAKnYDhrH3suwActyk0x7Fn7JOAeRc6v3NJkzi41E4nvW_S8L6IUinCTxh6BobrveQ9wyZgu4szhVu-AD6HEXC6woc58ZNObEgHZsSgU7aWGzqMvXWzHxBDldjx8M0-uG-cM-NJslPG5GT7H7VOxzfe55OZ4kwl50xmYXU-Rmqz4_zEB59GYuM3Mw-sS0FdO_R_MPnpXv4udY8CcfqKZBnSSW3GUSMSWdbaKZCMYecgz0s_r0vk6nnKzwVxVPr-uCj6xCktG70TZZYCsSsKvFp09HthjAg28CT5obBJKMDC3a7a2bBOpsT_4M_db1_8dhEcSe3Op2ypjbF9wnO-r9xEq34cVz-0P_l-IVO9UG65H0.K82O8A2ChAXoOtfVSWVD9w';
    const accessToken = new CognitoToken(tokenToTest);

    try {
      accessToken.isAccessToken();

    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    catch ( e: any ) {
      // eslint-disable-next-line jest/no-conditional-expect, jest/prefer-to-be
      expect(e.message).toEqual('invalid token');
    }

    try {
      accessToken.isIdToken();
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    catch ( e: any ) {
      // eslint-disable-next-line jest/no-conditional-expect, jest/prefer-to-be
      expect(e.message).toEqual('invalid token');
    }
  });
});
